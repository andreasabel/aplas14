\section{Reduction}
\label{sec:red}

In this section, we describe the implementation of parametrized
reduction $\red_n$ in Agda.  As a prerequisite, we need to define
substitution, which in term depends on renaming 
\citep{bentonHurKennedyMcBride:jar12}.

A \emph{renaming} from context $\Gam$ to context $\Del$, written $\Del
\aleq \Gam$, is a mapping from variables of $\Gam$ to those of $\Del$
of the same type $\va$.

\input{Rename}

The function $\arename$ lifts such a mapping to terms.  We also give
an inductive relational specification $\IndRen$ of $\arename$ which
will be useful to show that strong normalization (sn) is closed under
renaming and even the undoing of renaming (if a renamed term is sn, so
is the original term). 

\input{IndRen}

Building on renaming, we define parallel well-typed substitution.
From this, we get the special case of substituting de Bruijn index 0. 

\input{Subst0}

Reduction $t \red_n t'$ is formalized as inductive family $\vt \nred n
\vtprime$ with four constructors \AgdaInductiveConstructor{Î²...} 
representing the contraction rules and one congruence rule $\tcong$ to
reduce in subterms.

\input{NReduction}

The congruence rule says that we can reduce a term, suggestively
called $\vEt$, to a term $\vEtprime$, if (1) $\vEt$ decomposes into
$\vE[\vt]$, a context $\vE$ filled by $\vt$, and (2) $\vEtprime$ into
$\vE[\vtprime]$, and (3) $\vt$ reduces to $\vtprime$.  As witnessed by
relation $\NbetaHole$, context
$\vE : \NbetaCxt\;\Gam\;\Del\;\va\;\vb\;\vn\;\vnprime$ produces a term
$\vEt : \Tm\;\Gam\;\vb$ of depth $\vnprime$ if filled with a term $\vt
: \Tm\;\Del\;\va$ of depth $\vn$.  The depth is unchanced except for
case $\anext$, which increases the depth by 1.  
Thus,  $\vt \nred n \vtprime$ can contract every subterm that is under
at most $\vn$ many $\anext$s.


\input{NContexts}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "aplas14.tex"
%%% End: 
